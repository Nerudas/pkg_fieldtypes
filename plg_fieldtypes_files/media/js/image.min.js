(function(a){a(document).ready(function(){a("[data-input-image]").each(function(){var j=a(this),c=j.attr("id"),d=j.find(".form"),k=d.find('input[type="file"]'),e=d.find(".loading"),f=d.find("img");var g=Joomla.getOptions(c,""),h=a("#"+g.folder_field),b=a(h).val();if(g.folder_field==""||h.length==0||b==""){a(j).remove()}else{setInterval(function(){a(d).height(Math.round((a(j).width()/4)*3))},10);l()}k.on("change",function(m){if(!d.hasClass("disable")){i(m.target.files)}});j.on("drag dragstart dragend dragover dragenter dragleave drop",function(m){m.preventDefault();m.stopPropagation()}).on("dragover dragenter",function(){if(!d.hasClass("disable")){d.addClass("dragend")}}).on("dragleave dragend drop",function(){if(!d.hasClass("disable")){d.removeClass("dragend")}}).on("drop",function(m){if(!d.hasClass("disable")){i(m.originalEvent.dataTransfer.files)}});function i(n){var m=new FormData();m.append("type","image");m.append("folder",b);m.append("filename",g.filename);m.append("noimage",g.noimage);m.append("files[]",n[0]);a.ajax({type:"POST",dataType:"json",url:"index.php?option=com_ajax&plugin=files&group=fieldtypes&format=json&task=uploadFile",processData:false,contentType:false,cache:false,global:false,async:false,data:m,beforeSend:function(){a(f).attr("src","");a(e).show()},complete:function(){a(e).hide()},success:function(o){if(o.success){a(f).attr("src",g.site_root+"/"+o.data)}else{a(f).attr("src","")}},error:function(o){console.error(o.status+": "+o.statusText)}})}function l(){a.ajax({type:"POST",dataType:"json",url:"index.php?option=com_ajax&plugin=files&group=fieldtypes&format=json&task=getFile",cache:false,global:false,async:false,data:{type:"image",folder:b,filename:g.filename,noimage:g.noimage},beforeSend:function(){a(f).attr("src","");a(e).show()},complete:function(){a(e).hide()},success:function(m){console.log(m);if(m.success){a(f).attr("src",g.site_root+"/"+m.data)}else{a(f).attr("src","")}},error:function(m){console.error(m.status+": "+m.statusText)}})}a(d).find("a.remove").on("click",function(){a.ajax({type:"POST",dataType:"json",url:"index.php?option=com_ajax&plugin=files&group=fieldtypes&format=json&task=deleteFile",cache:false,global:false,async:false,data:{type:"image",folder:b,filename:g.filename,noimage:g.noimage},beforeSend:function(){a(f).attr("src","");a(e).show()},complete:function(){a(e).hide()},success:function(m){if(m.success){a(f).attr("src",g.site_root+"/"+m.data)}else{a(f).attr("src","")}},error:function(m){console.error(m.status+": "+m.statusText)}})})})})})(jQuery);