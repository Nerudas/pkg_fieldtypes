(function(a){a(document).ready(function(){a("[data-input-images]").each(function(){var b=a(this),n=b.attr("id"),s=b.attr("data-name"),d=b.find(".form"),m=b.find(".limit-error"),k=d.find('input[type="file"]'),e=d.find(".loading"),j=b.find(".result");var p=Joomla.getOptions(n,""),h=a("#"+p.folder_field),f=a(h).val(),q=p.value,l=p.text,c=p.unique,o=p.limit;if(p.folder_field==""||h.length==0||f==""){a(b).remove()}else{setInterval(function(){a(d).height(Math.round((a(b).width()/10)*2))},10);i()}k.on("change",function(t){if(!d.hasClass("disable")){r(t.target.files)}});b.on("drag dragstart dragend dragover dragenter dragleave drop",function(t){t.preventDefault();t.stopPropagation()}).on("dragover dragenter",function(){if(!d.hasClass("disable")){d.addClass("dragend")}}).on("dragleave dragend drop",function(){if(!d.hasClass("disable")){d.removeClass("dragend")}}).on("drop",function(t){if(!d.hasClass("disable")){console.log("bbb");r(t.originalEvent.dataTransfer.files)}});function r(v){var u=a(j).find(".item").length,t=new FormData();t.append("type","images");t.append("root_folder",f);t.append("folder",p.folder);t.append("limit",o);t.append("unique",c);t.append("exist",u);a(v).each(function(x,w){if(o==0||u<o){t.append("files[]",w);u++}});a.ajax({type:"POST",dataType:"json",url:p.site_root+"index.php?option=com_ajax&plugin=files&group=fieldtypes&format=json&task=uploadFiles",processData:false,contentType:false,cache:false,global:false,async:false,data:t,beforeSend:function(){a(j).html("");a(e).show()},complete:function(){i()},error:function(w){console.error(w.status+": "+w.statusText)}})}function i(){var u=q,t=a(j).find(".item");a(t).each(function(w,x){var v=a(x).attr("data-key"),y={};if(l){y.text=a(x).find('[name*="[text]"]').val()}y.ordering=a(x).find('[name*="[ordering]"]').val();u[v]=y});a.ajax({type:"POST",dataType:"json",url:p.site_root+"index.php?option=com_ajax&plugin=files&group=fieldtypes&format=json&task=getFiles",cache:false,global:false,async:false,data:{type:"images",root_folder:f,folder:p.folder,noimage:p.noimage,value:u,text:l,filed_name:s},beforeSend:function(){a(j).html("");a(e).show()},complete:function(){a(e).hide();a(j.selector+" > ul").sortable({handle:".actions .move",start:function(v,w){j.addClass("sortable")},stop:function(v,w){a(j).find(".item").each(function(x,y){a(y).find('[name*="[ordering]"]').val(x+1)});j.removeClass("sortable")}})},success:function(v){if(v.success){a(j).html(v.data);g()}else{a(j).html("");g()}},error:function(v){a(j).html("");console.error(v.status+": "+v.statusText);g()}})}a("body").on("click",j.selector+" .item .actions .remove",function(){a.ajax({type:"POST",dataType:"json",url:p.site_root+"index.php?option=com_ajax&plugin=files&group=fieldtypes&format=json&task=deleteFiles",cache:false,global:false,async:false,data:{file:a(this).data("file")},beforeSend:function(){a(j).html("");a(e).show()},complete:function(){i()},error:function(t){console.error(t.status+": "+t.statusText)}})});function g(){if(o==0||a(j).find(".item").length<o){a(d).show();a(m).hide();return true}a(d).hide();a(m).show();return true}})})})(jQuery);