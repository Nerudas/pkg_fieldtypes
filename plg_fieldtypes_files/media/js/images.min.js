(function(a){a(document).ready(function(){a("[data-input-images]").each(function(){var k=a(this),b=k.attr("id"),g=k.attr("data-name"),c=k.find(".form"),l=c.find('input[type="file"]'),e=c.find(".loading"),o=k.find(".result");var f=Joomla.getOptions(b,""),i=a("#"+f.folder_field),j=a(i).val(),n=f.value,m=f.text;if(f.folder_field==""||i.length==0||j==""){a(k).remove()}else{setInterval(function(){a(c).height(Math.round((a(k).width()/10)*2))},10);d()}l.on("change",function(p){if(!c.hasClass("disable")){h(p.target.files)}});k.on("drag dragstart dragend dragover dragenter dragleave drop",function(p){p.preventDefault();p.stopPropagation()}).on("dragover dragenter",function(){if(!c.hasClass("disable")){c.addClass("dragend")}}).on("dragleave dragend drop",function(){if(!c.hasClass("disable")){c.removeClass("dragend")}}).on("drop",function(p){if(!c.hasClass("disable")){console.log("bbb");h(p.originalEvent.dataTransfer.files)}});function h(q){var p=new FormData();p.append("type","images");p.append("root_folder",j);p.append("folder",f.folder);a(q).each(function(s,r){p.append("files[]",r)});a.ajax({type:"POST",dataType:"json",url:"index.php?option=com_ajax&plugin=files&group=fieldtypes&format=json&task=uploadFiles",processData:false,contentType:false,cache:false,global:false,async:false,data:p,beforeSend:function(){a(o).html("");a(e).show()},complete:function(){d()},error:function(r){console.error(r.status+": "+r.statusText)}})}function d(){var q=n,p=a(o).find(".item");a(p).each(function(s,t){var r=a(t).attr("data-key"),u={};if(m){u.text=a(t).find('[name*="[text]"]').val()}u.ordering=a(t).find('[name*="[ordering]"]').val();q[r]=u});a.ajax({type:"POST",dataType:"json",url:"index.php?option=com_ajax&plugin=files&group=fieldtypes&format=json&task=getFiles",cache:false,global:false,async:false,data:{type:"images",root_folder:j,folder:f.folder,noimage:f.noimage,value:q,text:m,filed_name:g},beforeSend:function(){a(o).html("");a(e).show()},complete:function(){a(e).hide()},success:function(r){if(r.success){a(o).html(r.data)}else{a(o).html("")}},error:function(r){a(o).html("");console.error(r.status+": "+r.statusText)}})}a("body").on("click",o.selector+" .item .actions .remove",function(){a.ajax({type:"POST",dataType:"json",url:"index.php?option=com_ajax&plugin=files&group=fieldtypes&format=json&task=deleteFiles",cache:false,global:false,async:false,data:{file:a(this).data("file")},beforeSend:function(){a(o).html("");a(e).show()},complete:function(){d()},error:function(p){console.error(p.status+": "+p.statusText)}})});a(o.selector+" > ul").sortable({handle:".actions .move",start:function(p,q){o.addClass("sortable")},stop:function(p,q){a(o).find(".item").each(function(r,s){a(s).find('[name*="[ordering]"]').val(r+1)});o.removeClass("sortable")}})})})})(jQuery);